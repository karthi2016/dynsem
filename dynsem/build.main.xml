<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="all" name="ds">

	<!-- Key input modules -->
	<property name="sdfmodule" value="ds" />
	<property name="metasdfmodule" value="Stratego-ds" />
	<property name="esvmodule" value="ds" />
	<property name="strmodule" value="ds" />
	<property name="ppmodule" value="ds-pp" />
	<property name="sigmodule" value="ds-sig" />

	<!-- Project directories -->
	<property location="trans" name="trans" />
	<property location="editor/java" name="src-gen" />
	<property location="include" name="include" />
	<property location="lib" name="lib" />
	<property location="target/classes" name="build" />
	<property location="bin/dist" name="dist" />
	<property name="sdf-src-gen" location="src-gen" />
	<property name="pp" location="${sdf-src-gen}/pp" />
	<property name="signatures" location="${sdf-src-gen}/signatures" />
	<property name="syntax" location="${sdf-src-gen}/syntax" />
	<property name="lib-gen" location="${include}" />
	<property name="syntax.rel" location="${syntax}" relative="yes" />
	<property name="trans.rel" location="trans" relative="yes" />
	<property name="include.rel" location="${include}" relative="yes" />
	<property name="lib-gen.rel" location="${lib-gen}" relative="yes" />


	<!-- Imports -->
	<property name="build.sdf.imports" value="
    -Idef &quot;${basedir}/lib/Coq/Stratego-Coq.def&quot;
    -I &quot;${basedir}/lib/Coq/&quot;
		" />
	<property name="build.stratego.args" value=" 
                    --library
                    -I &quot;${trans}&quot;
                    -I &quot;${basedir}&quot;
		                -I &quot;${basedir}/lib/runtime-libraries/org.spoofax.meta.runtime.libraries&quot;
                    -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm -la stratego-parallel" />
	<!-- Optional: external .def and .jar locations
    <property name="externaldef" location="syntax/${sdfmodule}.def"/>
    <property name="externaljar" value="../lib.jar"/>
    <property name="externaljarflags" value="-la org.lib"/>
    -->
	<!-- <property name="externaljarflags" value="-la org.metaborg.runtime.task.interop" /> -->

	<!-- Environment configuration for command-line builds -->
	<property name="nativepath" value="${eclipse.spoofaximp.nativeprefix}" />

	<!-- used for building inside of Eclipse -->
	<import file="build.generated.xml" />

	<!-- The files for which the on-save handler is called before building. -->
	<path id="call-onsave.files">
		<fileset dir=".">
			<include name="**/*.sdf3" />
			<include name="**/*.nab" />
			<include name="**/*.ts" />
		</fileset>
	</path>

	<!-- Main target -->
	<target depends="link-lib-files, spoofaximp.default.jar" name="all" />
	<target depends="generate-sources-java" name="generate-sources"/>
	<target depends="package-java" name="package"/>
	
	<target name="os-detection">
		<condition property="isWin">
			<os family="windows" />
		</condition>
	</target>

	<target depends="os-detection" name="link-lib-files" unless="isWin">
		<symlink link="${basedir}/lib/runtime-libraries" overwrite="true" resource="${basedir}/../../runtime-libraries/" />
	</target>

</project>
